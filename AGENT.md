# AGENT.md

This file provides guidance to AI coding assistants when working with this repository.

## Project Overview

CalCard is a self-hostable **CalDAV/CardDAV server** implementing RFC 4791 (CalDAV) and RFC 6352 (CardDAV) for calendar and contact synchronization. The project consists of a Go backend server and a Nuxt 3 SPA frontend.

## Project Structure

```
/
├── stories/                 # User stories for implementation
│   ├── backend/             # Backend stories (001–030)
│   ├── frontend/            # Frontend stories (031–050)
│   └── continuation/        # Post-core-feature stories (100+)
├── server/                  # Go backend (Fiber v3, GORM, SQLite/PostgreSQL)
│   ├── cmd/server/          # Application entrypoint
│   ├── configs/             # Configuration examples (config.yaml.example)
│   ├── docs/                # Swagger/OpenAPI (auto-generated by swag)
│   ├── internal/
│   │   ├── adapter/         # HTTP handlers, repositories, auth (JWT, OAuth), WebDAV
│   │   ├── domain/          # Domain models and repository interfaces
│   │   ├── infrastructure/  # Database, email, server setup, migrations
│   │   ├── usecase/         # Business logic (auth, calendar, contact, sharing, import/export)
│   │   └── config/          # Configuration loading
│   ├── Dockerfile           # Multi-stage Alpine build (static binary)
│   └── docker-compose*.yml  # SQLite and PostgreSQL configurations
└── webinterface/            # Nuxt 3 SPA frontend
    ├── pages/               # File-based routing (auth, calendar, contacts)
    ├── components/          # Auto-imported Vue components (auth, calendar, contacts, common)
    ├── stores/              # Pinia stores (auth, calendars, contacts)
    ├── composables/         # useApi (fetch + auth + response unwrap), useAppToast
    ├── middleware/           # Route guards (auth, guest)
    ├── layouts/             # default (app shell), auth (centered card)
    ├── types/               # TypeScript interfaces (auth, calendar, contacts, api)
    └── plugins/             # PrimeVue service registration
```

## Context Files

`AGENT.md` and `CLAUDE.md` files are placed throughout the project to provide context-specific guidance:

- `/AGENT.md` - Root level project overview
- `/server/AGENT.md` - Server directory structure, startup sequence, API surface
- `/server/internal/AGENT.md` - Backend architecture overview
- `/server/internal/adapter/AGENT.md` - Adapter layer details
- `/server/internal/domain/AGENT.md` - Domain layer details
- `/server/internal/infrastructure/AGENT.md` - Infrastructure layer details
- `/server/internal/usecase/AGENT.md` - Use case layer details
- `/server/internal/usecase/auth/AGENT.md` - Authentication use cases
- `/webinterface/AGENT.md` - Frontend architecture and conventions

- `/CLAUDE.md` - Root level project overview
- `/server/CLAUDE.md` - Server directory structure, startup sequence, API surface
- `/server/internal/CLAUDE.md` - Backend architecture overview
- `/server/internal/adapter/CLAUDE.md` - Adapter layer details
- `/server/internal/domain/CLAUDE.md` - Domain layer details
- `/server/internal/infrastructure/CLAUDE.md` - Infrastructure layer details
- `/server/internal/usecase/CLAUDE.md` - Use case layer details
- `/server/internal/usecase/auth/CLAUDE.md` - Authentication use cases
- `/webinterface/CLAUDE.md` - Frontend architecture and conventions

## Key Technologies

| Layer | Stack |
|-------|-------|
| Backend | Go 1.22+, Fiber v3, GORM, JWT, OAuth2/OIDC, SAML 2.0 |
| Database | SQLite (default), PostgreSQL (production) |
| Protocols | CalDAV (RFC 4791), CardDAV (RFC 6352), WebDAV-Sync |
| Frontend | Nuxt 3 (SPA), Vue 3 Composition API, TypeScript (strict) |
| UI | PrimeVue 4.x (Material preset), Tailwind CSS 3, PrimeIcons |
| Libraries | Pinia, VueUse, Vuelidate, FullCalendar |

## Development Commands

```bash
# Backend
cd server && go build ./...                   # Build
cd server && go test ./...                    # Run tests
cd server && go run ./cmd/server              # Run dev server

# Frontend
cd webinterface && pnpm dev                   # Dev server
cd webinterface && pnpm nuxt typecheck        # TypeScript check (strict mode)
cd webinterface && pnpm build                 # Production build

# Docker
cd server && docker-compose up --build                                    # SQLite
cd server && docker-compose -f docker-compose.postgres.yml up --build     # PostgreSQL
```

## Development Instructions

1. **Follow the stories**: Implementation details are in `stories/backend/` and `stories/frontend/`. Stories are numbered sequentially — check which are already implemented by reviewing the commit history and existing code.
2. **Check existing patterns**: Review existing code in similar areas before implementing new features. The calendar and contacts implementations share many patterns.
3. **Propose alternatives**: If you encounter issues or have better solutions than proposed in the story, propose a new implementation approach.
4. **Write tests**: Always write unit and integration tests to verify your implementation works correctly.
5. **Check AGENT.md files**: Read the relevant AGENT.md before working in any sub-area of the codebase.
